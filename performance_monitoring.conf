# Apple SMB Extensions Performance Monitoring Configuration
# This configuration enables comprehensive monitoring of Apple SMB extension performance

# Monitoring settings
enable_apple_monitoring=true
monitoring_interval_seconds=60
max_history_entries=1000
log_level=INFO

# Performance thresholds (alert if exceeded)
apple_detection_threshold_us=1000          # Alert if detection takes >1ms
apple_setup_threshold_us=5000              # Alert if setup takes >5ms
memory_threshold_per_client_kb=2           # Alert if memory >2KB per client
cpu_overhead_threshold_percent=5           # Alert if CPU overhead >5%
network_overhead_threshold_ms=1            # Alert if network overhead >1ms
cache_miss_threshold_percent=10            # Alert if cache misses >10%

# Metrics to collect
collect_detection_metrics=true
collect_memory_metrics=true
collect_cpu_metrics=true
collect_network_metrics=true
collect_cache_metrics=true
collect_capability_metrics=true
collect_error_metrics=true

# Apple-specific metrics
apple_client_detection_rate=true
apple_capability_success_rate=true
apple_extension_usage_stats=true
apple_context_processing_time=true
apple_negotiation_latency=true

# Directory traversal performance
directory_traversal_metrics=true
large_directory_optimization=true
file_id_lookup_performance=true
attribute_query_performance=true

# Performance alerts
enable_alerts=true
alert_method=syslog                    # syslog, file, or both
alert_log_file=/var/log/ksmbd_aapl_alerts.log
alert_email=admin@example.com          # Optional email alerts

# Performance baselines
baseline_detection_time_us=2.8
baseline_setup_time_us=7.8
baseline_memory_per_client_bytes=242
baseline_cpu_overhead_percent=0.039
baseline_network_overhead_ms=0.2

# Performance targets
target_detection_time_us=1000
target_setup_time_us=5000
target_memory_per_client_bytes=2048
target_cpu_overhead_percent=5.0
target_network_overhead_ms=1000

# Performance optimization flags
enable_apple_state_caching=true
enable_context_buffer_pooling=true
enable_fast_path_optimization=true
enable_capability_batching=true
enable_directory_caching=true

# Cache settings
apple_state_cache_size=1000
context_buffer_pool_size=100
directory_cache_ttl_seconds=300
capability_cache_ttl_seconds=3600

# Memory pressure monitoring
enable_memory_pressure_monitoring=true
memory_warning_threshold_mb=100
memory_critical_threshold_mb=500
gc_trigger_threshold_mb=200

# Load testing configuration
load_test_enabled=false
load_test_concurrent_clients=100
load_test_duration_seconds=300
load_test_ramp_up_seconds=30

# Performance profiling
enable_profiling=false
profile_output_dir=/var/log/ksmbd_profiles/
profile_retention_days=7

# Statistical analysis
enable_statistics=true
statistics_window_minutes=60
percentile_calculations=50,90,95,99
enable_trend_analysis=true

# Performance regression detection
regression_detection_enabled=true
regression_threshold_percent=10
regression_window_minutes=1440        # 24 hours

# Integration with external monitoring systems
prometheus_enabled=false
prometheus_port=9090
prometheus_metrics_path=/metrics

graphite_enabled=false
graphite_host=localhost
graphite_port=2003
graphite_prefix=ksmbd.aapl

# Performance report generation
generate_reports=true
report_interval_hours=6
report_output_dir=/var/log/ksmbd_reports/
report_retention_days=30

# Debug settings (for development/testing)
debug_mode=false
debug_log_level=DEBUG
debug_trace_apple_operations=true
debug_memory_allocations=true
debug_performance_critical_paths=true

# Health check settings
health_check_enabled=true
health_check_interval_seconds=300
health_check_timeout_seconds=10

# Performance SLA settings
sla_detection_time_p99_ms=1
sla_setup_time_p99_ms=5
sla_memory_usage_p99_kb=2
sla_throughput_min_ops_per_sec=1000

# Apple-specific performance counters
[APPLE_COUNTERS]
# Detection metrics
detection_attempts=0
detection_successes=0
detection_failures=0
detection_avg_time_us=0.0

# Setup metrics
setup_attempts=0
setup_successes=0
setup_failures=0
setup_avg_time_us=0.0

# Memory metrics
memory_allocations=0
memory_deallocations=0
memory_peak_usage_bytes=0
memory_current_usage_bytes=0

# Capability metrics
capability_negotiations=0
capability_successes=0
capability_failures=0
capability_avg_time_us=0.0

# Context metrics
context_parses=0
context_parse_errors=0
context_avg_time_us=0.0

# Directory performance metrics
directory_traversals=0
directory_avg_time_ms=0.0
directory_cache_hits=0
directory_cache_misses=0

# File operation metrics
file_operations=0
file_avg_time_ms=0.0
file_id_lookups=0
file_id_lookup_avg_time_us=0.0

# Error metrics
total_errors=0
memory_errors=0
network_errors=0
protocol_errors=0

# Performance alerts configuration
[ALERTS]
# Critical alerts (immediate action required)
detection_time_critical=true
setup_time_critical=true
memory_usage_critical=true
cpu_overhead_critical=true

# Warning alerts (investigation recommended)
cache_miss_rate_warning=true
capability_failure_warning=true
network_latency_warning=true
error_rate_warning=true

# Info alerts (monitoring only)
new_client_detected=true
capability_negotiated=true
performance_improvement=true

# Performance optimization recommendations
[OPTIMIZATIONS]
# High impact optimizations
high_impact_optimizations=apple_state_caching,context_pooling,fast_path_optimization

# Medium impact optimizations
medium_impact_optimizations=capability_batching,directory_caching,memory_pooling

# Low impact optimizations
low_impact_optimizations=debug_optimization,logging_optimization,statistical_optimization